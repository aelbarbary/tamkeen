{% load static %}

<link href ="//cdn.datatables.net/1.10.16/css/jquery.dataTables.min.css" rel="stylesheet">
<script src="{% static "vendor/jquery/jquery.min.js" %}"></script>
<script data-cfasync="false" type="text/javascript" src="//cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js">
</script>
<script >
$(document).ready(function() {
  var t = $('#example').DataTable();

  $.ajax({
             type: "GET",
             dataType: "json",
             url: "/rest/members",
             success: function(data){
               data.forEach(function(entry) {
                 uw_waiver = "/media/" + entry["fields"]["uw_waiver"]
                 t.row.add( [
                     "<img src='/media/" + entry["fields"]["photo"] + "' width=100px/>",
                     entry["fields"]["first_name"],
                     entry["fields"]["last_name"],
                     entry["fields"]["email"],
                     entry["fields"]["whats_app"],
                     entry["fields"]["gender"],
                     _calculateAge(new Date(entry["fields"]["dob"])),
                     "<a href='" + uw_waiver + "'> <img src='" + uw_waiver + "' width=100px/>",
                 ] ).draw( false );
             }
         )}
       });
} );

function _calculateAge(birthday) { // birthday is a date
    var ageDifMs = Date.now() - birthday.getTime();
    var ageDate = new Date(ageDifMs); // miliseconds from epoch
    return Math.abs(ageDate.getUTCFullYear() - 1970);
}
</script>

<table id="example" class="display" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th>Pic</th>
                <th>First Name</th>
                <th>Last Name</th>
                <th>Email</th>
                <th>WhatsApp</th>
                <th>Gender</th>
                <th>Age</th>
                <th>UW Waiver</th>
            </tr>
        </thead>
        <tfoot>
            <tr>
              <th>Pic</th>
              <th>First Name</th>
              <th>Last Name</th>
              <th>Email</th>
              <th>WhatsApp</th>
              <th>Gender</th>
              <th>Age</th>
              <th>UW Waiver</th>
            </tr>
        </tfoot>
    </table>
